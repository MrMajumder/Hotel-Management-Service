CREATE OR REPLACE FUNCTION ROOM_SEARCH(ROOMT IN VARCHAR2)
RETURN NUMBER IS

 BEGIN
 FOR R IN (SELECT ROOM_ID FROM ROOM WHERE ROOM_TYPE = ROOMT AND RESERVATION_ID IS NULL)
	LOOP
		DBMS_OUTPUT.PUT_LINE('HELLO');
		RETURN R.ROOM_ID;
	END LOOP;
RETURN 0;
END;
/

-- 
-- BEGIN
-- 	DBMS_OUTPUT.PUT_LINE(ROOM_SEARCH('Family Suit'));
-- END;
-- /


CREATE OR REPLACE FUNCTION SERVICE_ENTRY(SERVICET IN VARCHAR2, SERVICED IN VARCHAR2, ID IN NUMBER, RID IN NUMBER)
RETURN NUMBER IS 
 EMPID NUMBER;
 COSTT NUMBER;
 B_ID NUMBER;
 
BEGIN 
FOR R IN (SELECT SERVICE_ID FROM SERVICES WHERE SERVICE_TYPE = SERVICET AND USER_ID IS NULL)
	LOOP
	DBMS_OUTPUT.PUT_LINE('HELLO');
	FOR E IN (SELECT USER_ID FROM EMPLOYEE WHERE POSITION = SERVICET AND AVAILABILITY = 0)
	LOOP 
		DBMS_OUTPUT.PUT_LINE('HELLO');
		SELECT BILL_ID INTO B_ID FROM HOTEL_BILL WHERE RESERVATION_ID = (SELECT DISTINCT RO.RESERVATION_ID FROM ROOM RO, RESERVATION RE WHERE RO.ROOM_ID = RID AND RE.USER_ID = ID);
		DBMS_OUTPUT.PUT_LINE('HELLO');
		UPDATE SERVICES SET USER_ID = E.USER_ID, DESCRIPTION = SERVICED WHERE SERVICE_ID = R.SERVICE_ID;
		UPDATE EMPLOYEE SET AVAILABILITY = 1 WHERE USER_ID = E.USER_ID;
		SELECT COST INTO COSTT FROM SERVICES WHERE SERVICE_ID = R.SERVICE_ID;
		UPDATE BILL SET COST = (COST + COSTT) WHERE BILL_ID = B_ID;	
		INSERT INTO ROOM_HB_SERV_RECEIVES VALUES (R.SERVICE_ID, RID, B_ID, 1, ACT_ID.NEXTVAL);
		RETURN 1;
	END LOOP;
END LOOP;
	RETURN 0;
EXCEPTION
WHEN NO_DATA_FOUND THEN
 RETURN 2;
END;
/

-- SELECT DISTINCT RO.RESERVATION_ID FROM ROOM RO, RESERVATION RE WHERE (RO.ROOM_ID = 1 AND RE.USER_ID = 2);
-- 
-- 
-- BEGIN
-- 	DBMS_OUTPUT.PUT_LINE(SERVICE_ENTRY('Food Service', 'FFSDF', 1, 1));
-- END;
-- /
-- UPDATE EMPLOYEE SET AVAILABILITY = 0 WHERE USER_ID = 11;
-- 