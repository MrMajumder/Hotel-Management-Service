CREATE OR REPLACE FUNCTION GETROOMS(RESID IN VARCHAR2)
RETURN VARCHAR2 IS
	ANS VARCHAR2(1024) := '';
BEGIN
	FOR X IN (SELECT A.ROOM_ID FROM ROOM A, RESERVATION B WHERE A.RESERVATION_ID = RESID AND B.RESERVATION_ID = RESID AND B.RESERVATION_ACTIVE = 1)
	LOOP
		IF(ANS IS NULL) THEN
			ANS := X.ROOM_ID;
		ELSE
			ANS := (ANS ||','|| X.ROOM_ID);
		END IF;
	END LOOP;
	RETURN ANS;
EXCEPTION
	WHEN NO_DATA_FOUND THEN
		RETURN 0;
END;
/

CREATE OR REPLACE FUNCTION GETROOMRENT(RESID IN VARCHAR2)
RETURN VARCHAR2 IS
	ANS VARCHAR2(1024) := '';
BEGIN
	FOR X IN (SELECT RENT FROM ROOM A, RESERVATION B WHERE A.RESERVATION_ID = RESID AND B.RESERVATION_ID = RESID AND B.RESERVATION_ACTIVE = 1)
	LOOP
		IF(ANS IS NULL) THEN
			ANS := X.RENT;
		ELSE
			ANS := (ANS ||','|| X.RENT);
		END IF;
	END LOOP;
	RETURN ANS;
EXCEPTION
	WHEN NO_DATA_FOUND THEN
		RETURN 0;
END;
/


CREATE OR REPLACE FUNCTION GETSERV(RESID IN VARCHAR2)
RETURN VARCHAR2 IS
	BID NUMBER;
	ANS VARCHAR2(1024) := '';
BEGIN
	SELECT BILL_ID INTO BID FROM HOTEL_BILL WHERE RESERVATION_ID = RESID;
	FOR X IN (SELECT SERVICE_ID FROM ROOM_HB_SERV_RECEIVES WHERE BILL_ID = BID)
	LOOP
		IF(ANS IS NULL) THEN
			ANS := X.SERVICE_ID;
		ELSE
			ANS := (ANS ||','|| X.SERVICE_ID);
		END IF;
	END LOOP;
	RETURN ANS;
EXCEPTION
	WHEN NO_DATA_FOUND THEN
		RETURN 0;
END;
/

CREATE OR REPLACE FUNCTION GETSERVCOST(RESID IN VARCHAR2)
RETURN VARCHAR2 IS
	BID NUMBER;
	ANS VARCHAR2(1024) := '';
BEGIN
	SELECT BILL_ID INTO BID FROM HOTEL_BILL WHERE RESERVATION_ID = RESID;
	FOR X IN (SELECT B.COST AS COST FROM ROOM_HB_SERV_RECEIVES A, SERVICES B WHERE A.BILL_ID = BID AND A.SERVICE_ID = B.SERVICE_ID)
	LOOP
		IF(ANS IS NULL) THEN
			ANS := X.COST;
		ELSE
			ANS := (ANS ||','|| X.COST);
		END IF;
	END LOOP;
	RETURN ANS;
EXCEPTION
	WHEN NO_DATA_FOUND THEN
		RETURN 0;
END;
/

CREATE OR REPLACE FUNCTION GETSERVACTIONID(RESID IN VARCHAR2)
RETURN VARCHAR2 IS
	BID NUMBER;
	ANS VARCHAR2(1024) := '';
BEGIN
	SELECT BILL_ID INTO BID FROM HOTEL_BILL WHERE RESERVATION_ID = RESID;
	FOR X IN (SELECT ACTION_ID FROM ROOM_HB_SERV_RECEIVES WHERE BILL_ID = BID)
	LOOP
		IF(ANS IS NULL) THEN
			ANS := X.ACTION_ID;
		ELSE
			ANS := (ANS ||','|| X.ACTION_ID);
		END IF;
	END LOOP;
	RETURN ANS;
EXCEPTION
	WHEN NO_DATA_FOUND THEN
		RETURN 0;
END;
/


CREATE OR REPLACE FUNCTION GETSERVROOMS(RESID IN VARCHAR2)
RETURN VARCHAR2 IS
	BID NUMBER;
	ANS VARCHAR2(1024) := '';
BEGIN
	SELECT BILL_ID INTO BID FROM HOTEL_BILL WHERE RESERVATION_ID = RESID;
	FOR X IN (SELECT ROOM_ID FROM ROOM_HB_SERV_RECEIVES WHERE BILL_ID = BID)
	LOOP
		IF(ANS IS NULL) THEN
			ANS := X.ROOM_ID;
		ELSE
			ANS := (ANS ||','|| X.ROOM_ID);
		END IF;
	END LOOP;
	RETURN ANS;
EXCEPTION
	WHEN NO_DATA_FOUND THEN
		RETURN 0;
END;
/

CREATE OR REPLACE FUNCTION UPDATEDUE (MONEY IN NUMBER, RESID IN NUMBER)
RETURN NUMBER IS
	RETVAL NUMBER;
	CURDUE NUMBER;
	BID NUMBER;
BEGIN
	SELECT DUE INTO CURDUE FROM HOTEL_BILL WHERE RESERVATION_ID = RESID;
	IF(CURDUE < MONEY) THEN
		RETURN 0;
	ELSE
		UPDATE HOTEL_BILL SET DUE = CURDUE - MONEY WHERE RESERVATION_ID = RESID;
		RETURN 1;
	END IF;
EXCEPTION
	WHEN NO_DATA_FOUND THEN
		RETURN 0;
END;
/
